// ===============================================================================
// CONFIGURATION PROFILE FOR BELUGA HPC CLUSTER
// ===============================================================================
// This configuration is specific to the Compute Canada (Alliance) HPC system.
// It defines the necessary parameters to run Nextflow on Beluga.
// ===============================================================================

params.config_profile_description = 'Alliance Beluga HPC config'  // Profile description
params.config_profile_contact = 'https://docs.alliancecan.ca/wiki/Technical_support'  // Technical support link
params.config_profile_url = 'docs.alliancecan.ca/wiki/Nextflow'  // Nextflow documentation for Alliance

log.level = 'DEBUG'

// ===============================================================================
// SLURM PROCESS CONFIGURATION
// ===============================================================================

process {
    executor = 'slurm'
    maxRetries = 3
    errorStrategy = { task.exitStatus in [125,139] ? 'retry' : 'finish' }

    // Default resources
    cpus = 1
    memory = '4.GB'
    time = '1h'
    
    // Process-specific configurations
    withName: 'BOWTIE_ALIGN' {
        cpus = 4

        // choose the right memory code
        memory = 2.GB
        time = '11h'
        clusterOptions = '--account=def-xroucou'
    }
    
    withName: 'STAR_ALIGN' {
        cpus = 8
        memory = 40.GB
        time = '11h'
        clusterOptions = '--account=def-xroucou'
    }
}

executor {
    name = 'slurm'
    pollInterval = '60 sec'
    submitRateLimit = '60/1min'
    queueSize = 100
}

// Resource limits
params {
    max_time = 168.h
}

// ===============================================================================
// PATHS SETUP
// ===============================================================================


params.path_pipeline_directory = "${projectDir}"
params.reference_files_directory = "${projectDir}/../../reference"



params.bowtie_filter_index = [
    'HS': "${params.reference_files_directory}/HS/snRNA_snoRNA_rRNA_HS_ensembl113_index/snRNA_snoRNA_rRNA_HS_ensembl113_index",
    'CE': "${params.reference_files_directory}/CE/CE_GTF.gtf",
    'DM': "${params.reference_files_directory}/DM/DM_GTF.gtf",
    'SC': "${params.reference_files_directory}/SC/SC_GTF.gtf",
    'DR': "${params.reference_files_directory}/DR/DR_GTF.gtf",
    'SM': "${params.reference_files_directory}/SM/SM_GTF.gtf"
]

params.star_index = [
    'HS': "${params.reference_files_directory}/HS/HS_GRCh38_ensembl_114_star_index",
    'CE': "${params.reference_files_directory}/CE/CE_GTF.gtf",
    'DM': "${params.reference_files_directory}/DM/DM_GTF.gtf",
    'SC': "${params.reference_files_directory}/SC/SC_GTF.gtf",
    'DR': "${params.reference_files_directory}/DR/DR_GTF.gtf",
    'SM': "${params.reference_files_directory}/SM/SM_GTF.gtf"
]

// Parameter for multiqc 
params.input_csv = "${projectDir}/../Samplesheet_example/test.csv"
params.trimmed_fastq_dir = "${projectDir}/../../trimmed_fastq"